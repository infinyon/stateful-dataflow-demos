apiVersion: 0.5.0

meta:
  name: slack-package
  version: 0.0.1
  namespace: examples

types:
  ## Fields generated from [SDF Schema](./slack-schema.json).
  ## These fields are compatible with the Slack API.
  slack-event:
    type: object
    properties:
      blocks:
        type: list
        type-name: slack-event-blocks
        items:
          type: enum
          type-name: slack-event-untagged
          tagging: untagged
          oneOf:
            text-section:
              type: text-section
            fields-section:
              type: fields-section
  text-section:
    type: object
    properties:
      text:
        type: text-object
      type:
        type: enum
        type-name: section-text-type
        serialize:
          rename: type
        deserialize:
          rename: type        
        oneOf:
          section:
            type: null
            serialize:
              rename: section
            deserialize:
              rename: section
  fields-section:
    type: object
    properties:
      fields:
        type: list
        type-name: section-fields-fields
        items:
          type: text-object
      type:
        type: enum
        type-name: section-fields-type
        serialize:
          rename: type
        deserialize:
          rename: type        
        oneOf:
          section:
            type: null
            serialize:
              rename: section
            deserialize:
              rename: section
  text-object:
    type: object
    properties:
      text:
        type: string
      type:
        type: enum
        type-name: text-object-type
        serialize:
          rename: type
        deserialize:
          rename: type        
        oneOf:
          mrkdwn:
            type: null
            serialize:
              rename: mrkdwn
            deserialize:
              rename: mrkdwn

  ## Input object Populated by the User
  ## This field is an abstracted object that is used to create a Slack Event
  fields-obj:
    type: object
    properties:
      title:
        type: string
      fields:
        type: list
        type-name: fields-list
        items:
          type: string

functions:
  ## Function to turn fields-obj into a slack-event
  make-slack-fields-event:
    operator: map
    inputs:
      - name: obj
        type: fields-obj
    output:
      type: slack-event

  ## Test API to ensure proper decoding/enocoding of Slack Events
  test-event:
    operator: map
    inputs:
      - name: sev
        type: slack-event
    output:
      type: slack-event